name: Awesome-DCIST-T4
on:
    push:
        branches: main
    pull_request:
        branches:
            - main
            - develop
jobs:
  Awesome-DCIST-T4:
    runs-on: self-hosted
    container: osrf/ros:jazzy-desktop-full
    steps:
      - name: Clean Artifacts
        shell: bash
        run: |
          rm -rf src || rm -rf precommit_venv

      - name: Update Dependencies
        shell: bash
        run: |
            sudo apt update
            sudo apt install -y git python3-pip python3 python3-virtualenv ros-jazzy-ament-cmake

      - name: Check out repository code
        uses: actions/checkout@v4
        with:
            path: src/awesome_dcist_t4
            submodules: recursive

      - name: Pre-commit
        shell: bash
        run: |
            python3 -m virtualenv precommit_venv --download
            source precommit_venv/bin/activate
            pip install pre-commit
            cd src/awesome_dcist_t4
            pre-commit run --all-files

      - name: Install Everything
        shell: bash
        run: |
            vcs import src < src/awesome_dcist_t4/install/packages.yaml
            rosdep update
            rosdep install -q --from-paths src --ignore-src -r -y || echo "Installed rosdeps"
            source /opt/ros/jazzy/setup.bash
            colcon build

      - run: echo "🍏 This job's status is ${{ job.status }}."
