---
launch:
  - arg: {name: verbosity, default: '0'}
  - arg: {name: conf_name}
  - arg: {name: use_sim_time}
  - arg: {name: model_name, default: ade20k-efficientvit_seg_l2}
  - arg: {name: labelspace_name, default: ade20k_mit, description: Label remapping configuration}
  - arg: {name: disable_publish_dsg, default: 'false'}
  # frontleft camera
  - set_remap: {from: hydra/input/frontleft/depth_registered/image_rect, to: /spot/frontleft/depth/image_rect}
  - set_remap: {from: hydra/input/frontleft/rgb/image_raw, to: /spot/frontleft/color/image_raw}
  - set_remap: {from: hydra/input/frontleft/rgb/camera_info, to: /spot/frontleft/color/camera_info}
  - set_remap: {from: hydra/input/frontleft/semantic/image_raw, to: /spot/frontleft/semantic/image_raw}
  - node:
      pkg: semantic_inference_ros
      exec: closed_set_node
      namespace: spot/frontleft
      name: segmentation
      args: >
        --config-utilities-file $(find-pkg-share semantic_inference_ros)/config/models/$(var model_name).yaml
        --config-utilities-file $(find-pkg-share semantic_inference_ros)/config/label_groupings/$(var labelspace_name).yaml@output/recolor
        --config-utilities-yaml {output: {recolor: {colormap_path: $(find-pkg-share semantic_inference_ros)/config/distinct_150_colors.csv}}}
        --config-utilities-yaml {segmenter: {model: {model_file: $(var model_name).onnx}}}
        --config-utilities-yaml {worker: {max_queue_size: 1, image_separation_s: 0.0}}
        --config-utilities-yaml {image_rotator: {rotation: ROTATE_90_CLOCKWISE}}
  # frontright camera
  - set_remap: {from: hydra/input/frontright/depth_registered/image_rect, to: /spot/frontright/depth/image_rect}
  - set_remap: {from: hydra/input/frontright/rgb/image_raw, to: /spot/frontright/color/image_raw}
  - set_remap: {from: hydra/input/frontright/rgb/camera_info, to: /spot/frontright/color/camera_info}
  - set_remap: {from: hydra/input/frontright/semantic/image_raw, to: /spot/frontright/semantic/image_raw}
  - node:
      pkg: semantic_inference_ros
      exec: closed_set_node
      namespace: spot/frontright
      name: segmentation
      args: >
        --config-utilities-file $(find-pkg-share semantic_inference_ros)/config/models/$(var model_name).yaml
        --config-utilities-file $(find-pkg-share semantic_inference_ros)/config/label_groupings/$(var labelspace_name).yaml@output/recolor
        --config-utilities-yaml {output: {recolor: {colormap_path: $(find-pkg-share semantic_inference_ros)/config/distinct_150_colors.csv}}}
        --config-utilities-yaml {segmenter: {model: {model_file: $(var model_name).onnx}}}
        --config-utilities-yaml {worker: {max_queue_size: 1, image_separation_s: 0.0}}
        --config-utilities-yaml {image_rotator: {rotation: ROTATE_90_CLOCKWISE}}
  - set_remap: {if: $(var disable_publish_dsg), from: hydra/backend/dsg, to: hydra/backend/remapped_dsg}
  # hydra
  - node:
      pkg: hydra_ros
      exec: hydra_ros_node
      name: hydra
      namespace: spot
      param:
        - {name: use_sim_time, value: $(var use_sim_time)}
      args: >
        --config-utilities-file $(find-pkg-share dcist_launch_system)/config/$(var conf_name)/spot_hydra.yaml
        --config-utilities-file $(find-pkg-share hydra)/config/label_spaces/$(var labelspace_name)_label_space.yaml
        --config-utilities-yaml {glog_level: 0, glog_verbosity: $(var verbosity)}
        --config-utilities-yaml {log_path: $(env HOME)/.hydra/adt4}
        --config-utilities-yaml {robot_id: 0, odom_frame: spot/odom, robot_frame: spot/body, map_frame: map}
